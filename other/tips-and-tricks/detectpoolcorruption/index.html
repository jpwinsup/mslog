<!doctype html><html lang=ja data-theme=light><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><title>プール破損を検知する</title><link rel=icon href=https://jpwinsup.github.io/mslog/images/favicon.ico><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css integrity="sha512-NhSC1YmyruXifcj/KFRWoC561YpHpc5Jtzgvbuzx5VozKpWvQ+4nXhPdFgmx8xqexRcpAglTj9sIBWINXa8x5w==" crossorigin=anonymous referrerpolicy=no-referrer><link rel=stylesheet href=https://jpwinsup.github.io/mslog/css/style.min.2cf2d83b70054c6a1f941ece9e04f670c1ca9e5d7906b9f613c2128026f68c85.css integrity="sha256-LPLYO3AFTGoflB7OngT2cMHKnl15Brn2E8ISgCb2jIU=" crossorigin=anonymous><script defer data-domain=jpwinsup.github.io/mslog src=https://jpwinsup-mslog-plausible.japaneast.cloudapp.azure.com/js/script.js></script></head><body><header class="header header-color"><nav class=navbar><ul class=navbar-list><li class=navbar-item><a href=https://jpwinsup.github.io/mslog/><img class=navbar-logo src=https://jpwinsup.github.io/mslog/images/Microsoft-logo_rgb_c-wht.webp alt="Microsoft Logo"></a></li><li class=navbar-item><a class=navbar-item-style href=https://jpwinsup.github.io/mslog/>ホーム</a></li><li class=navbar-item><a class=navbar-item-style href=https://cssjpn.github.io/ target=_blank>サポート情報</a></li><li class=navbar-item><a class=navbar-item-style href=https://jpwinsup.github.io/blog/ target=_blank>サポート ブログ</a></li></ul></nav></header><div class=page-wrapper><div class="sidebar sidebar-color"><h3 class="sidebar-header sidebar-header-style">カテゴリー</h3><ul class=sidebar-list><li class="sidebar-list-item sidebar-list-item-style"><a class=sidebar-list-link-style href=https://jpwinsup.github.io/mslog/directory-service/>Directory Service</a></li><li class="sidebar-list-item sidebar-list-item-style"><a class=sidebar-list-link-style href=https://jpwinsup.github.io/mslog/hyper-v/>Hyper-V</a></li><li class="sidebar-list-item sidebar-list-item-style"><a class=sidebar-list-link-style href=https://jpwinsup.github.io/mslog/cluster/>クラスター</a></li><li class="sidebar-list-item sidebar-list-item-style"><a class=sidebar-list-link-style href=https://jpwinsup.github.io/mslog/storage/>ストレージ</a></li><li class="sidebar-list-item sidebar-list-item-style"><a class=sidebar-list-link-style href=https://jpwinsup.github.io/mslog/performance/>パフォーマンス</a></li><li class="sidebar-list-item sidebar-list-item-style"><a class=sidebar-list-link-style href=https://jpwinsup.github.io/mslog/networking/>ネットワーク一般</a></li><li class="sidebar-list-item sidebar-list-item-style"><a class=sidebar-list-link-style href=https://jpwinsup.github.io/mslog/wireless/>ワイヤレス ネットワーク</a></li><li class="sidebar-list-item sidebar-list-item-style"><a class=sidebar-list-link-style href=https://jpwinsup.github.io/mslog/file-services/>ファイル サービス</a></li><li class="sidebar-list-item sidebar-list-item-style"><a class=sidebar-list-link-style href=https://jpwinsup.github.io/mslog/uwp/>UWP</a></li><li class="sidebar-list-item sidebar-list-item-style"><a class=sidebar-list-link-style href=https://jpwinsup.github.io/mslog/rdp/>リモートアクセス</a></li><li class="sidebar-list-item sidebar-list-item-style"><a class=sidebar-list-link-style href=https://jpwinsup.github.io/mslog/core/>コア</a></li><li class="sidebar-list-item sidebar-list-item-style"><a class=sidebar-list-link-accent-style href=https://jpwinsup.github.io/mslog/other/>その他</a></li><li class="sidebar-list-item sidebar-list-item-style"><a class=sidebar-list-link-style href=https://jpwinsup.github.io/mslog/faq/>FAQ</a></li></ul></div><div class="content content-color"><article><h1>プール破損を検知する</h1><h3>目次</h3><nav id=TableOfContents><ul><li><a href=#driver-verifier-について>Driver Verifier について</a></li><li><a href=#driver-verifier-有効化手順>Driver Verifier 有効化手順</a></li><li><a href=#driver-verifier-無効化手順>Driver Verifier 無効化手順</a></li></ul></nav><p>本記事はマイクロソフト社員によって公開されております。<br>いつも弊社製品をご利用いただきまして誠にありがとうございます。Windows プラットフォーム サポートの栗木です。<br>今回は、Windows OS に標準でインストールされている Driver Verifier ツールにより、プール破損を検知する方法をご紹介いたします。</p><h2 id=driver-verifier-について>Driver Verifier について</h2><p>Driver Verifier はドライバ開発者用のテスト ツールであり、ドライバによるメモリへの読み書きなどを監視し、不正な処理を検知すると BSoD (ブルースクリーン) を発生させます。<br>Driver Verifier でプールを監視することにより不正なメモリ アクセス処理が行われたタイミングでメモリ ダンプが生成されるため、このメモリ ダンプを解析することにより、プール破損の原因を特定できる場合がございます。</p><p>ただし、Driver Verifier はパフォーマンス低下や別問題の STOP エラーが発生するリスクがありますので、以下の注意事項を確認し、検証環境で現象再現試験を行うか、運用環境と同じ構成の検証環境で十分に事前検証を行ったうえで 本番環境に設定することをご検討ください。</p><p>注意事項<br>・監視期間中はシステムに負荷がかかり、パフォーマンスが低下する可能性があります。<br>・発生している問題以外でも STOP エラーが発生する可能性があります。<br>・Driver Verifier の設定を行った状態でも問題を検知できない可能性があります。</p><p>また、BSoD (ブルースクリーン) が発生した際にメモリ ダンプを出力させるため、本記事でご紹介する Driver Verifier 設定の他にメモリ ダンプの出力設定も別途必要になります。</p><p>完全メモリ ダンプの出力設定
<a href=https://jpwinsup.github.io/blog/2021/02/15/Performance/Hang_BSOD/MemoryDump/ target=_blank>https://jpwinsup.github.io/blog/2021/02/15/Performance/Hang_BSOD/MemoryDump/</a></p><h2 id=driver-verifier-有効化手順>Driver Verifier 有効化手順</h2><ol><li><p>[スタート] メニューから [ファイル名を指定して実行] を選択し、&ldquo;verifier.exe&rdquo; を指定して [OK] ボタンを押します。</p><p><img src=https://jpwinsup.github.io/mslog/other/tips-and-tricks/detectpoolcorruption/winr.png alt></p></li><li><p>&ldquo;ドライバの検証ツール マネージャ&rdquo; が起動したら、[カスタム設定を作成する (コード開発者用)] をクリックし、[次へ] をクリックします。</p><p><img src=https://jpwinsup.github.io/mslog/other/tips-and-tricks/detectpoolcorruption/custom.png alt></p></li><li><p>特別なプールとプールのトラックの項目にチェックを付け、[次へ] をクリックします。</p><p><img src=https://jpwinsup.github.io/mslog/other/tips-and-tricks/detectpoolcorruption/setting.png alt></p></li><li><p>[このコンピュータにインストールされているドライバーをすべて自動的に選択する] をクリックし、[完了] をクリックします。</p><p><img src=https://jpwinsup.github.io/mslog/other/tips-and-tricks/detectpoolcorruption/all.png alt></p></li><li><p>&ldquo;変更を有効にするには、コンピュータを再起動する必要があります。&rdquo; というダイアログボックスが表示されますので、[OK] を押します。</p><p><img src=https://jpwinsup.github.io/mslog/other/tips-and-tricks/detectpoolcorruption/restart.png alt></p></li><li><p>コンピュータを再起動します。再起動後に Driver Verifier の設定が有効になります。</p></li></ol><p>以上で設定は完了になります。これにより、プール破損を検知したら、BSoD が発生するようになります。
調査が完了しましたら、Driver Verifier 無効化手順により、Driver Verifier を無効化してください。</p><h2 id=driver-verifier-無効化手順>Driver Verifier 無効化手順</h2><ol><li><p>[スタート] メニューから [ファイル名を指定して実行] を選択し、&ldquo;verifier.exe&rdquo; を指定して [OK] ボタンを押します。</p><p><img src=https://jpwinsup.github.io/mslog/other/tips-and-tricks/detectpoolcorruption/winr.png alt></p></li><li><p>&ldquo;ドライバの検証ツール マネージャ&rdquo; が起動したら、[既存の設定を削除する] を選択し、[完了] をクリックします。</p><p><img src=https://jpwinsup.github.io/mslog/other/tips-and-tricks/detectpoolcorruption/remove.png alt></p></li><li><p>確認のダイアログ ボックスが表示されますので、[はい] をクリックします。</p><p><img src=https://jpwinsup.github.io/mslog/other/tips-and-tricks/detectpoolcorruption/confirm.png alt></p></li><li><p>&ldquo;変更を有効にするには、コンピュータを再起動する必要があります。&rdquo; というダイアログボックスが表示されますので、[OK] を押します。</p><p><img src=https://jpwinsup.github.io/mslog/other/tips-and-tricks/detectpoolcorruption/restart.png alt></p></li><li><p>コンピュータを再起動します。</p></li></ol><p>本情報の内容（添付文書、リンク先などを含む）は、作成日時点でのものであり、予告なく変更される場合があります。</p></article></div></div><footer class="footer footer-color"><div class=footer-container><img class=footer-logo src=https://jpwinsup.github.io/mslog/images/Microsoft-logo_rgb_c-wht.webp alt="Microsoft Logo"><nav class=footer-links><ul class=footer-links-list><li class=footer-links-item><a class=footer-links-style href=https://jpwinsup.github.io/mslog/>ホーム</a></li><li class=footer-links-item><a class=footer-links-style href=https://cssjpn.github.io/ target=_blank>サポート情報</a></li><li class=footer-links-item><a class=footer-links-style href=https://jpwinsup.github.io/blog/ target=_blank>サポート ブログ</a></li></ul></nav></div><p class="footer-copy footer-copy-style">© 2023 Microsoft Japan Windows サポート チーム</p></footer></body></html>