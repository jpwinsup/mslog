<!doctype html><html lang=ja data-theme=light><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><title>TSS 実行時にエラーが発生する</title><link rel=icon href=https://jpwinsup.github.io/mslog/images/favicon.ico><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css integrity="sha512-NhSC1YmyruXifcj/KFRWoC561YpHpc5Jtzgvbuzx5VozKpWvQ+4nXhPdFgmx8xqexRcpAglTj9sIBWINXa8x5w==" crossorigin=anonymous referrerpolicy=no-referrer><link rel=stylesheet href=https://jpwinsup.github.io/mslog/css/style.min.0884e9ffa24a703f06b6d98b2b42adddea22340fed1815ae183abb3fc616c9ef.css integrity="sha256-CITp/6JKcD8GttmLK0Kt3eoiNA/tGBWuGDq7P8YWye8=" crossorigin=anonymous><script defer data-domain=jpwinsup.github.io/mslog src=https://jpwinsup-mslog-plausible.japaneast.cloudapp.azure.com/js/script.js></script></head><body><header class="header header-color"><nav class=navbar><ul class=navbar-list><li class=navbar-item><a href=https://jpwinsup.github.io/mslog/><img class=navbar-logo src=https://jpwinsup.github.io/mslog/images/Microsoft-logo_rgb_c-wht.webp alt="Microsoft Logo"></a></li><li class=navbar-item><a class=navbar-item-style href=https://jpwinsup.github.io/mslog/>ホーム</a></li><li class=navbar-item><a class=navbar-item-style href=https://cssjpn.github.io/ target=_blank>サポート情報</a></li><li class=navbar-item><a class=navbar-item-style href=https://jpwinsup.github.io/blog/ target=_blank>サポート ブログ</a></li></ul></nav></header><div class=page-wrapper><div class="sidebar sidebar-color"><h3 class="sidebar-header sidebar-header-style">カテゴリー</h3><ul class=sidebar-list><li class="sidebar-list-item sidebar-list-item-style"><a class=sidebar-list-link-style href=https://jpwinsup.github.io/mslog/directory-service/>Directory Service</a></li><li class="sidebar-list-item sidebar-list-item-style"><a class=sidebar-list-link-style href=https://jpwinsup.github.io/mslog/hyper-v/>Hyper-V</a></li><li class="sidebar-list-item sidebar-list-item-style"><a class=sidebar-list-link-style href=https://jpwinsup.github.io/mslog/cluster/>クラスター</a></li><li class="sidebar-list-item sidebar-list-item-style"><a class=sidebar-list-link-style href=https://jpwinsup.github.io/mslog/storage/>ストレージ</a></li><li class="sidebar-list-item sidebar-list-item-style"><a class=sidebar-list-link-style href=https://jpwinsup.github.io/mslog/performance/>パフォーマンス</a></li><li class="sidebar-list-item sidebar-list-item-style"><a class=sidebar-list-link-style href=https://jpwinsup.github.io/mslog/networking/>ネットワーク一般</a></li><li class="sidebar-list-item sidebar-list-item-style"><a class=sidebar-list-link-style href=https://jpwinsup.github.io/mslog/wireless/>ワイヤレス ネットワーク</a></li><li class="sidebar-list-item sidebar-list-item-style"><a class=sidebar-list-link-style href=https://jpwinsup.github.io/mslog/file-services/>ファイル サービス</a></li><li class="sidebar-list-item sidebar-list-item-style"><a class=sidebar-list-link-style href=https://jpwinsup.github.io/mslog/uwp/>UWP</a></li><li class="sidebar-list-item sidebar-list-item-style"><a class=sidebar-list-link-style href=https://jpwinsup.github.io/mslog/rdp/>リモートアクセス</a></li><li class="sidebar-list-item sidebar-list-item-style"><a class=sidebar-list-link-style href=https://jpwinsup.github.io/mslog/core/>コア</a></li><li class="sidebar-list-item sidebar-list-item-style"><a class=sidebar-list-link-accent-style href=https://jpwinsup.github.io/mslog/other/>その他</a></li><li class="sidebar-list-item sidebar-list-item-style"><a class=sidebar-list-link-style href=https://jpwinsup.github.io/mslog/faq/>FAQ</a></li></ul></div><div class="content content-color"><article><h1>TSS 実行時にエラーが発生する</h1><h3>目次</h3><nav id=TableOfContents><ul><li><a href=#1-tssps1-が認識されない>1. TSS.ps1 が認識されない</a></li><li><a href=#2-スクリプトの実行が無効になっている>2. スクリプトの実行が無効になっている</a></li><li><a href=#3-ツールの有効期限が切れている>3. ツールの有効期限が切れている</a></li><li><a href=#4-デジタル署名に保存されているハッシュ値が一致しない>4. デジタル署名に保存されているハッシュ値が一致しない</a></li></ul></nav><p>本記事はマイクロソフト社員によって公開されております。</p><p>いつも弊社製品をご利用いただきまして誠にありがとうございます。Windows プラットフォーム サポートの栗木です。<br>本記事では、資料採取ツールである TSS（TroubleShootingScript）を実行する際に発生するエラーと対処方法についてご案内いたします。</p><p>Introduction to TroubleShootingScript toolset (TSS) - Windows Client<br><a href=https://learn.microsoft.com/en-us/troubleshoot/windows-client/windows-tss/introduction-to-troubleshootingscript-toolset-tss target=_blank>https://learn.microsoft.com/en-us/troubleshoot/windows-client/windows-tss/introduction-to-troubleshootingscript-toolset-tss</a></p><h2 id=1-tssps1-が認識されない>1. TSS.ps1 が認識されない</h2><p><img src=https://jpwinsup.github.io/mslog/other/tools/tss/notfound.png alt><br>原因：<br>カレント ディレクトリに TSS.ps1 ファイルが配置されていない場合、TSS.ps1 ファイルを認識することができません。</p><p>対処法：<br>TSS.zipを解凍したフォルダに cd コマンドで移動してから TSS を実行してください。<br>例として <code>C:\tools\TSS</code> に TSS を解凍した場合は、以下のコマンドになります。</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>cd C:\tools\TSS
</span></span></code></pre></div><h2 id=2-スクリプトの実行が無効になっている>2. スクリプトの実行が無効になっている</h2><p><img src=https://jpwinsup.github.io/mslog/other/tools/tss/execution_policies.png alt><br>原因：<br>お客様環境での実行ポリシーの設定により、外部から入手した PowerShell スクリプトの実行がブロックされている場合、TSS.ps1 を実行することができません。</p><p>about Execution Policies<br><a href=https://learn.microsoft.com/en-us/powershell/module/microsoft.powershell.core/about/about_execution_policies target=_blank>https://learn.microsoft.com/en-us/powershell/module/microsoft.powershell.core/about/about_execution_policies</a></p><p>対処法：<br>Set-ExecutionPolicy コマンドにより、ExecutionPolicy の設定を変更後、TSS を実行してください。<br>Scope に Process を設定しているため、実行している PowerShell 以外に影響はなく、PowerShell を終了すれば、変更した設定は元に戻ります。</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>Set-ExecutionPolicy RemoteSigned -Scope <span style=color:#ff7b72>Process</span> -Force
</span></span><span style=display:flex><span>Get-ExecutionPolicy -List
</span></span></code></pre></div><p>※通常は、RemoteSigned で TSS は実行可能になりますが、変更してもエラーが発生する場合は、RemoteSigned を Bypass へ置き換えて、Set-ExecutionPolicy を実行してください。<br>※Get-ExecutionPolicy コマンドで現在の実行ポリシーの設定が確認できます。</p><p>Set-ExecutionPolicy<br><a href=https://learn.microsoft.com/en-us/powershell/module/microsoft.powershell.security/set-executionpolicy target=_blank>https://learn.microsoft.com/en-us/powershell/module/microsoft.powershell.security/set-executionpolicy</a><br>Get-ExecutionPolicy<br><a href=https://learn.microsoft.com/en-us/powershell/module/microsoft.powershell.security/get-executionpolicy target=_blank>https://learn.microsoft.com/en-us/powershell/module/microsoft.powershell.security/get-executionpolicy</a></p><h2 id=3-ツールの有効期限が切れている>3. ツールの有効期限が切れている</h2><p><img src=https://jpwinsup.github.io/mslog/other/tools/tss/outdated.png alt><br>原因：<br>TSS の仕様により、実行している TSS のバージョンのリリース日から３０日が経過すると、実行できないようにしているが原因になります。</p><p>対処法：<br>再度、TSS を <a href=https://aka.ms/getTSS target=_blank>https://aka.ms/getTSS</a> からダウンロードするか、以下のコマンドを実行し、ツールをアップデートしてください。</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>.\TSS.<span style=color:#79c0ff>ps1</span> -Update
</span></span></code></pre></div><h2 id=4-デジタル署名に保存されているハッシュ値が一致しない>4. デジタル署名に保存されているハッシュ値が一致しない</h2><p><img src=https://jpwinsup.github.io/mslog/other/tools/tss/zoneid.png alt><br>原因：<br>TSS.ps1 に変更を加えていないのにも関わらず上記エラーが出力されている場合、セキュリティソフトの影響が考えられます。<br>ウイルス対策ソフトや監視ソフトといったセキュリティ向上を目的として製品には、PowerShell スクリプトの実行に介入するアプリケーションが存在し、デジタル署名に保存されているハッシュ値が変わってしまうことが確認されております。</p><p>対処法：<br>TSS.zip を解凍したフォルダに cd コマンドで移動し、TSS を実行する前に以下のコマンドにより、インターネットからダウンロードした PowerShell スクリプトであることを示す ADS (Alternate Data Streams) の Zone.Identifier を削除することでエラーの回避が可能です。</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>Get-ChildItem -Recurse | Unblock-File
</span></span></code></pre></div><p>※コマンドには &ldquo;|"(パイプ) 記号が含まれます。<br>※英字の &ldquo;l&rdquo;(エル) や数字の &ldquo;1&rdquo;(いち) ではありません。</p><p>Unblock-File<br><a href=https://learn.microsoft.com/en-us/powershell/module/microsoft.powershell.utility/unblock-file target=_blank>https://learn.microsoft.com/en-us/powershell/module/microsoft.powershell.utility/unblock-file</a></p></article></div></div><footer class="footer footer-color"><div class=footer-container><img class=footer-logo src=https://jpwinsup.github.io/mslog/images/Microsoft-logo_rgb_c-wht.webp alt="Microsoft Logo"><nav class=footer-links><ul class=footer-links-list><li class=footer-links-item><a class=footer-links-style href=https://jpwinsup.github.io/mslog/>ホーム</a></li><li class=footer-links-item><a class=footer-links-style href=https://cssjpn.github.io/ target=_blank>サポート情報</a></li><li class=footer-links-item><a class=footer-links-style href=https://jpwinsup.github.io/blog/ target=_blank>サポート ブログ</a></li></ul></nav></div><p class="footer-copy footer-copy-style">© 2023 Microsoft Japan Windows サポート チーム</p></footer></body></html>