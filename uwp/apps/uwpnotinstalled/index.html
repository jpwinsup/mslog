<!doctype html><html lang=ja data-theme=light><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><title>UWPアプリが正常にインストールされていない事象の調査</title><link rel=icon href=https://jpwinsup.github.io/mslog/images/favicon.ico><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css integrity="sha512-NhSC1YmyruXifcj/KFRWoC561YpHpc5Jtzgvbuzx5VozKpWvQ+4nXhPdFgmx8xqexRcpAglTj9sIBWINXa8x5w==" crossorigin=anonymous referrerpolicy=no-referrer><link rel=stylesheet href=https://jpwinsup.github.io/mslog/css/style.min.0884e9ffa24a703f06b6d98b2b42adddea22340fed1815ae183abb3fc616c9ef.css integrity="sha256-CITp/6JKcD8GttmLK0Kt3eoiNA/tGBWuGDq7P8YWye8=" crossorigin=anonymous><script defer data-domain=jpwinsup.github.io/mslog src=https://jpwinsup-mslog-plausible.japaneast.cloudapp.azure.com/js/script.js></script></head><body><header class="header header-color"><nav class=navbar><ul class=navbar-list><li class=navbar-item><a href=https://jpwinsup.github.io/mslog/><img class=navbar-logo src=https://jpwinsup.github.io/mslog/images/Microsoft-logo_rgb_c-wht.webp alt="Microsoft Logo"></a></li><li class=navbar-item><a class=navbar-item-style href=https://jpwinsup.github.io/mslog/>ホーム</a></li><li class=navbar-item><a class=navbar-item-style href=https://cssjpn.github.io/ target=_blank>サポート情報</a></li><li class=navbar-item><a class=navbar-item-style href=https://jpwinsup.github.io/blog/ target=_blank>サポート ブログ</a></li></ul></nav></header><div class=page-wrapper><div class="sidebar sidebar-color"><h3 class="sidebar-header sidebar-header-style">カテゴリー</h3><ul class=sidebar-list><li class="sidebar-list-item sidebar-list-item-style"><a class=sidebar-list-link-style href=https://jpwinsup.github.io/mslog/directory-service/>Directory Service</a></li><li class="sidebar-list-item sidebar-list-item-style"><a class=sidebar-list-link-style href=https://jpwinsup.github.io/mslog/hyper-v/>Hyper-V</a></li><li class="sidebar-list-item sidebar-list-item-style"><a class=sidebar-list-link-style href=https://jpwinsup.github.io/mslog/cluster/>クラスター</a></li><li class="sidebar-list-item sidebar-list-item-style"><a class=sidebar-list-link-style href=https://jpwinsup.github.io/mslog/storage/>ストレージ</a></li><li class="sidebar-list-item sidebar-list-item-style"><a class=sidebar-list-link-style href=https://jpwinsup.github.io/mslog/performance/>パフォーマンス</a></li><li class="sidebar-list-item sidebar-list-item-style"><a class=sidebar-list-link-style href=https://jpwinsup.github.io/mslog/networking/>ネットワーク一般</a></li><li class="sidebar-list-item sidebar-list-item-style"><a class=sidebar-list-link-style href=https://jpwinsup.github.io/mslog/wireless/>ワイヤレス ネットワーク</a></li><li class="sidebar-list-item sidebar-list-item-style"><a class=sidebar-list-link-style href=https://jpwinsup.github.io/mslog/file-services/>ファイル サービス</a></li><li class="sidebar-list-item sidebar-list-item-style"><a class=sidebar-list-link-accent-style href=https://jpwinsup.github.io/mslog/uwp/>UWP</a></li><li class="sidebar-list-item sidebar-list-item-style"><a class=sidebar-list-link-style href=https://jpwinsup.github.io/mslog/rdp/>リモートアクセス</a></li><li class="sidebar-list-item sidebar-list-item-style"><a class=sidebar-list-link-style href=https://jpwinsup.github.io/mslog/core/>コア</a></li><li class="sidebar-list-item sidebar-list-item-style"><a class=sidebar-list-link-style href=https://jpwinsup.github.io/mslog/other/>その他</a></li><li class="sidebar-list-item sidebar-list-item-style"><a class=sidebar-list-link-style href=https://jpwinsup.github.io/mslog/faq/>FAQ</a></li></ul></div><div class="content content-color"><article><h1>UWPアプリが正常にインストールされていない事象の調査</h1><h3>目次</h3><nav id=TableOfContents><ul><li><a href=#情報採取スクリプトファイルの取得について>情報採取スクリプトファイルの取得について</a></li><li><a href=#資料採取手順>資料採取手順</a></li><li><a href=#各アプリのインストール-パス>各アプリのインストール パス</a></li></ul></nav><p>本記事はマイクロソフト社員によって公開されております。</p><p>こんにちは。 Windows Performance チームの栗木です。
本ブログでは、UWP アプリ（設定、電卓、付箋、フォト等）が正常にインストールされていない事象が発生した場合に採取いただきたい資料についてご紹介いたします。</p><h2 id=情報採取スクリプトファイルの取得について>情報採取スクリプトファイルの取得について</h2><p>以下の URL より &ldquo;TSS.zip&rdquo; をダウンロードおよび展開いただき、対象端末へ配置します。</p><p>ダウンロード先: <a href=https://aka.ms/getTSS target=_blank>https://aka.ms/getTSS</a></p><p>(注意) TSS は機能の拡張などにより内容が変更されることがあります。そのため、毎回上記のダウンロード先から TSS を取得いただき使用してください。</p><h2 id=資料採取手順>資料採取手順</h2><ol><li><p>UWP アプリが正常にインストールされていない事象が発生しているユーザーで端末にログインします。</p></li><li><p>管理者としてPowerShell を起動し、以下のコマンドより、スクリプトの実行を許可します。</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope <span style=color:#ff7b72>Process</span>
</span></span></code></pre></div></li><li><p>TSSを展開したパスに移動します。</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>cd <span style=color:#a5d6ff>&#34;C:\path\to\TSS&#34;</span>
</span></span></code></pre></div></li><li><p>以下のコマンドを実行し、資料採取を開始します。</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>.\TSS.<span style=color:#79c0ff>ps1</span> -Start -PRF_AppX -UEX_COM -Procmon -BasicLog -PSR -LogFolderPath <span style=color:#a5d6ff>&#34;C:\MS_DATA&#34;</span>
</span></span></code></pre></div><p>画面の指示にそって進み、以下のメッセージが出力されるまで待ちます。<br>Reproduce the issue and enter &lsquo;Y&rsquo; key AFTER finishing the repro (with window focus here) [Y]?</p></li><li><p>管理者権限ではない PowerShell を別に起動し、該当のアプリを以下のコマンドにより、インストールします。</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>Add-AppxPackage -Register <span style=color:#a5d6ff>&#34;C:\Windows\SystemApps\MicrosoftWindows.Client.CBS_cw5n1h2txyewy\AppXManifest.xml&#34;</span> -DisableDevelopmentMode -ForceApplicationShutdown
</span></span></code></pre></div><p>Add-AppxPackage: <a href=https://learn.microsoft.com/en-us/powershell/module/appx/add-appxpackage target=_blank>https://learn.microsoft.com/en-us/powershell/module/appx/add-appxpackage</a></p><p>この例では、Client.CBS をインストールしています。他のアプリをインストールする場合は、<strong>各アプリのインストール パス</strong>を参考にコマンドを変更してください。</p></li><li><p>管理者として起動していた PowerShell に戻り、 &lsquo;Y&rsquo; を入力し、資料採取を終了します。</p></li><li><p>C:\MS_DATAフォルダに資料(Zipファイル)が出力されておりますので、弊社へご提供ください。</p></li></ol><h2 id=各アプリのインストール-パス>各アプリのインストール パス</h2><ol><li><p>管理者としてPowerShell を実行し、作業用のフォルダにインストールされているアプリのリストを出力します。</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>md <span style=color:#a5d6ff>&#34;c:\temp&#34;</span>
</span></span><span style=display:flex><span>Get-AppxPackage -alluser &gt; <span style=color:#a5d6ff>&#34;c:\temp\appx-alluser.txt&#34;</span>
</span></span></code></pre></div><p>Get-AppxPackage: <a href=https://learn.microsoft.com/en-us/powershell/module/appx/get-appxpackage target=_blank>https://learn.microsoft.com/en-us/powershell/module/appx/get-appxpackage</a></p></li><li><p>出力した appx-alluser.txt から確認したいアプリの <strong>InstallLocation</strong> を確認します。
以下に代表的なアプリの例をご紹介します。なお、アプリのバージョンよって InstallLocation は異なります。</p><p>Name : Microsoft.Windows.Photos (フォト)<br>InstallLocation : C:\Program Files\WindowsApps\Microsoft.Windows.Photos_2022.31120.6008.0_x64__8wekyb3d8bbwe</p><p>Name : Microsoft.WindowsCalculator (電卓)<br>InstallLocation : C:\Program Files\WindowsApps\Microsoft.WindowsCalculator_11.2210.0.0_x64__8wekyb3d8bbwe</p><p>Name : Microsoft.Paint (ペイント)<br>InstallLocation : C:\Program Files\WindowsApps\Microsoft.Paint_11.2210.4.0_x64__8wekyb3d8bbwe</p></li><li><p>InstallLocation にある AppxManifest.xml を指定して、Add-AppxPackage コマンドを実行することにより、該当のアプリをインストールできます。</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>Add-AppxPackage -Register <span style=color:#a5d6ff>&#34;&lt;InstallLocation&gt;\AppxManifest.xml&#34;</span> -DisableDevelopmentMode -ForceApplicationShutdown
</span></span></code></pre></div><p>フォトの例</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>Add-AppxPackage -Register <span style=color:#a5d6ff>&#34;C:\Program Files\WindowsApps\Microsoft.Windows.Photos_2022.31120.6008.0_x64__8wekyb3d8bbwe\AppxManifest.xml&#34;</span> -DisableDevelopmentMode -ForceApplicationShutdown
</span></span></code></pre></div></li></ol></article></div></div><footer class="footer footer-color"><div class=footer-container><img class=footer-logo src=https://jpwinsup.github.io/mslog/images/Microsoft-logo_rgb_c-wht.webp alt="Microsoft Logo"><nav class=footer-links><ul class=footer-links-list><li class=footer-links-item><a class=footer-links-style href=https://jpwinsup.github.io/mslog/>ホーム</a></li><li class=footer-links-item><a class=footer-links-style href=https://cssjpn.github.io/ target=_blank>サポート情報</a></li><li class=footer-links-item><a class=footer-links-style href=https://jpwinsup.github.io/blog/ target=_blank>サポート ブログ</a></li></ul></nav></div><p class="footer-copy footer-copy-style">© 2023 Microsoft Japan Windows サポート チーム</p></footer></body></html>